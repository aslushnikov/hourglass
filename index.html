<meta name="viewport" content="width=device-width; initial-scale=1.0; maximum-scale=1.0;">
<body class=hourglass>
  <span class=fill></span>
</body>
<style>
.hourglass {
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 120px;
}

.fill {
  position: absolute;
  background-color: black;
  left: 0;
  right: 0;
}

.fill:not(.flipped) {
  bottom: 0;
}

.fill.flipped {
  top: 0;
}

.timerdone .fill {
  background-color: red;
}

body.timerdone {
  background-color: red;
}

</style>

<script>
  const $ = document.querySelector.bind(document);

  const totaltime = 5;
  let timestamp = Date.now();
  let flipped = false;
  let finished = false;

  $('body').addEventListener('click', () => {
    if (finished) {
      // resetting time
      flipped = false;
      timestamp = Date.now();
    } else {
      // flipping time
      flipped = !flipped;
      let timeleft = totaltime * 1000 - (Date.now() - timestamp);
      timestamp = Date.now() - timeleft;
    }
  });

  let fillElement = $('.fill');
  render();

  function render() {
    fillElement.classList.toggle('flipped', flipped);
    let timeleft = totaltime - (Date.now() - timestamp) / 1000;
    finished = timeleft <= 0;
    $('body').classList.toggle('timerdone', finished);
    fillElement.style.setProperty('height', (timeleft / totaltime * 100) + 'vh');
    requestAnimationFrame(render);
  }
</script>

